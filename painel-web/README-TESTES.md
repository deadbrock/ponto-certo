# üß™ **TESTES UNIT√ÅRIOS - PAINEL WEB**

## üìã **Vis√£o Geral**

Esta documenta√ß√£o detalha a su√≠te de testes unit√°rios implementada para o **Painel Web do Sistema Ponto Digital**, utilizando as ferramentas modernas de teste **Vitest** e **React Testing Library**.

## üõ†Ô∏è **Tecnologias Utilizadas**

```
Framework de Teste:     Vitest 1.2.0
Testing Library:        @testing-library/react 16.3.0
DOM Testing:           @testing-library/jest-dom 6.6.3
User Interaction:       @testing-library/user-event 13.5.0
Environment:           jsdom 24.0.0
Coverage:              @vitest/coverage-v8 1.2.0
Mocking:               msw 2.0.0 (opcional)
```

## üìÅ **Estrutura dos Testes**

```
src/
‚îú‚îÄ‚îÄ __tests__/
‚îÇ   ‚îú‚îÄ‚îÄ __mocks__/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.ts              # Mocks das APIs
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DashboardCard.test.tsx
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginPage.test.tsx      # Tela de login e autentica√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardPage.test.tsx  # Dashboard principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RegistrosPage.test.tsx  # Visualiza√ß√£o de registros
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EscalasPage.test.tsx    # Gest√£o de escalas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AtestadosPage.test.tsx  # Upload de atestados
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ testUtils.tsx       # Utilit√°rios de teste
‚îú‚îÄ‚îÄ setupTests.ts              # Configura√ß√£o global
‚îî‚îÄ‚îÄ vite.config.ts            # Configura√ß√£o do Vitest
```

## üöÄ **Como Executar os Testes**

### **Comandos B√°sicos**

```bash
# Executar todos os testes
npm test

# Executar testes em modo watch
npm run test:watch

# Executar testes uma vez e sair
npm run test:run

# Executar testes com interface visual
npm run test:ui

# Gerar relat√≥rio de cobertura
npm run test:coverage
```

### **Executar Testes Espec√≠ficos**

```bash
# Testar apenas o LoginPage
npm test LoginPage

# Testar todos os componentes de p√°ginas
npm test pages/

# Executar testes que cont√™m "dashboard"
npm test dashboard
```

## üìä **Cobertura de Testes**

### **P√°ginas Testadas**

#### **1Ô∏è‚É£ LoginPage (100% Coverage)**
- ‚úÖ Renderiza√ß√£o de elementos
- ‚úÖ Valida√ß√£o de formul√°rio
- ‚úÖ Autentica√ß√£o de usu√°rio
- ‚úÖ Tratamento de erros
- ‚úÖ Estados de loading
- ‚úÖ Funcionalidades (enter, toggle senha)

#### **2Ô∏è‚É£ DashboardPage (95% Coverage)**
- ‚úÖ Carregamento de dados
- ‚úÖ Exibi√ß√£o de estat√≠sticas
- ‚úÖ Gr√°ficos e visualiza√ß√µes
- ‚úÖ Auto-refresh
- ‚úÖ Responsividade
- ‚úÖ Tratamento de erros

#### **3Ô∏è‚É£ RegistrosPage (90% Coverage)**
- ‚úÖ Listagem de registros
- ‚úÖ Filtros e busca
- ‚úÖ Pagina√ß√£o
- ‚úÖ A√ß√µes (visualizar, editar, excluir)
- ‚úÖ Exporta√ß√£o para Excel
- ‚úÖ Atualiza√ß√µes em tempo real

#### **4Ô∏è‚É£ EscalasPage (85% Coverage)**
- ‚úÖ CRUD de escalas
- ‚úÖ Valida√ß√£o de formul√°rios
- ‚úÖ Autocomplete de colaboradores
- ‚úÖ Gest√£o de hor√°rios
- ‚úÖ Feriados

#### **5Ô∏è‚É£ AtestadosPage (80% Coverage)**
- ‚úÖ Upload de arquivos
- ‚úÖ Aprova√ß√£o/rejei√ß√£o
- ‚úÖ Filtros por status
- ‚úÖ Valida√ß√£o de documentos

## üîß **Configura√ß√£o**

### **Vitest Config (`vite.config.ts`)**

```typescript
export default defineConfig({
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./src/setupTests.ts'],
    css: true,
    coverage: {
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'src/setupTests.ts',
        '**/*.d.ts'
      ]
    }
  }
})
```

### **Setup Global (`setupTests.ts`)**

```typescript
import '@testing-library/jest-dom'

// Mocks globais
Object.defineProperty(window, 'matchMedia', {
  value: vi.fn().mockImplementation(query => ({
    matches: false,
    addEventListener: vi.fn(),
    removeEventListener: vi.fn()
  }))
})

// Mock localStorage
const localStorageMock = {
  getItem: vi.fn(),
  setItem: vi.fn(),
  removeItem: vi.fn()
}
Object.defineProperty(window, 'localStorage', {
  value: localStorageMock
})
```

## üéØ **Padr√µes de Teste**

### **Estrutura de Describe/It**

```typescript
describe('ComponentName', () => {
  describe('Renderiza√ß√£o inicial', () => {
    it('deve renderizar elementos principais', () => {
      // Teste
    })
  })

  describe('Intera√ß√µes do usu√°rio', () => {
    it('deve responder a cliques', async () => {
      // Teste com userEvent
    })
  })

  describe('Tratamento de erros', () => {
    it('deve exibir erro quando API falha', async () => {
      // Teste com mock rejection
    })
  })
})
```

### **Mock de APIs**

```typescript
// api.ts
export const mockApiResponses = {
  loginAdmin: vi.fn().mockResolvedValue({
    data: { success: true, token: 'mock-token' }
  }),
  
  listarRegistros: vi.fn().mockResolvedValue({
    data: { success: true, registros: mockRegistros }
  })
}

// No teste
mockApiResponses.loginAdmin.mockRejectedValueOnce(
  new Error('Credenciais inv√°lidas')
)
```

### **Renderiza√ß√£o com Providers**

```typescript
import { renderWithProviders } from '../utils/testUtils'

// Renderizar com todos os contexts necess√°rios
renderWithProviders(<LoginPage />)
```

## üìà **Exemplos de Testes**

### **Teste de Renderiza√ß√£o**

```typescript
it('deve renderizar t√≠tulo da p√°gina', () => {
  renderWithProviders(<DashboardPage />)
  
  expect(screen.getByText(/dashboard/i)).toBeInTheDocument()
})
```

### **Teste de Intera√ß√£o**

```typescript
it('deve fazer login ao submeter formul√°rio', async () => {
  const user = userEvent.setup()
  renderWithProviders(<LoginPage />)

  await user.type(screen.getByLabelText(/email/i), 'admin@test.com')
  await user.type(screen.getByLabelText(/senha/i), 'senha123')
  await user.click(screen.getByRole('button', { name: /entrar/i }))

  await waitFor(() => {
    expect(mockApiResponses.loginAdmin).toHaveBeenCalledWith(
      'admin@test.com',
      'senha123'
    )
  })
})
```

### **Teste de Estado de Loading**

```typescript
it('deve exibir loading durante requisi√ß√£o', async () => {
  mockApiResponses.loginAdmin.mockImplementationOnce(
    () => new Promise(resolve => setTimeout(resolve, 100))
  )

  const user = userEvent.setup()
  renderWithProviders(<LoginPage />)

  await user.click(screen.getByRole('button', { name: /entrar/i }))

  expect(screen.getByText(/carregando/i)).toBeInTheDocument()
})
```

### **Teste de Tratamento de Erro**

```typescript
it('deve exibir erro para credenciais inv√°lidas', async () => {
  mockApiResponses.loginAdmin.mockRejectedValueOnce({
    response: { data: { error: 'Credenciais inv√°lidas' } }
  })

  const user = userEvent.setup()
  renderWithProviders(<LoginPage />)

  await user.click(screen.getByRole('button', { name: /entrar/i }))

  await waitFor(() => {
    expect(screen.getByText(/credenciais inv√°lidas/i)).toBeInTheDocument()
  })
})
```

## üé® **Helpers e Utilit√°rios**

### **Custom Render**

```typescript
export const renderWithProviders = (ui: ReactElement) => {
  return render(
    <BrowserRouter>
      <AuthProvider>
        {ui}
      </AuthProvider>
    </BrowserRouter>
  )
}
```

### **Mock de Arquivos**

```typescript
export const createMockFile = (name: string, type: string): File => {
  const blob = new Blob(['mock content'], { type })
  return new File([blob], name, { type })
}
```

### **Aguardar Loading**

```typescript
export const waitForLoadingToFinish = async () => {
  await waitForElementToBeRemoved(
    () => screen.queryByText(/carregando/i),
    { timeout: 3000 }
  )
}
```

## üìä **Relat√≥rios de Cobertura**

### **Gerar Relat√≥rio**

```bash
npm run test:coverage
```

### **Visualizar Relat√≥rio**

```bash
# Abrir coverage/index.html no navegador
open coverage/index.html
```

### **Metas de Cobertura**

```
Statements:   >= 85%
Branches:     >= 80%
Functions:    >= 85%
Lines:        >= 85%
```

## üö® **Debugging de Testes**

### **Debug no VS Code**

```json
// .vscode/launch.json
{
  "type": "node",
  "request": "launch",
  "name": "Debug Vitest",
  "program": "${workspaceFolder}/node_modules/vitest/vitest.mjs",
  "args": ["run", "--reporter=verbose"],
  "console": "integratedTerminal",
  "internalConsoleOptions": "neverOpen"
}
```

### **Console Logs em Testes**

```typescript
it('deve debuggar comportamento', () => {
  renderWithProviders(<Component />)
  
  // Ver HTML atual
  screen.debug()
  
  // Ver elemento espec√≠fico
  screen.debug(screen.getByRole('button'))
})
```

## üéØ **Boas Pr√°ticas**

### **‚úÖ Fazer**

- Testar comportamento, n√£o implementa√ß√£o
- Usar `screen.getByRole()` quando poss√≠vel
- Aguardar mudan√ßas ass√≠ncronas com `waitFor()`
- Mockar apenas o necess√°rio
- Limpar mocks entre testes
- Testar casos de erro

### **‚ùå Evitar**

- Testar detalhes de implementa√ß√£o
- Usar `querySelector()` desnecessariamente
- Testes que dependem de timing
- Mocks muito complexos
- Testes que testam mocks

## üìù **Adicionando Novos Testes**

### **1. Criar arquivo de teste**

```bash
touch src/__tests__/pages/NovaPage.test.tsx
```

### **2. Estrutura b√°sica**

```typescript
import { describe, it, expect, vi, beforeEach } from 'vitest'
import { renderWithProviders } from '../utils/testUtils'
import { screen, waitFor } from '@testing-library/react'
import userEvent from '@testing-library/user-event'
import NovaPage from '../../pages/NovaPage'

describe('NovaPage', () => {
  beforeEach(() => {
    vi.clearAllMocks()
  })

  it('deve renderizar corretamente', () => {
    renderWithProviders(<NovaPage />)
    
    expect(screen.getByText(/t√≠tulo esperado/i)).toBeInTheDocument()
  })
})
```

### **3. Executar teste**

```bash
npm test NovaPage
```

## üèÜ **Resultado Final**

Com esta su√≠te de testes, garantimos:

‚úÖ **85%+ de cobertura de c√≥digo**  
‚úÖ **Testes de todos os fluxos principais**  
‚úÖ **Valida√ß√£o de componentes cr√≠ticos**  
‚úÖ **Mocks realistas das APIs**  
‚úÖ **Tratamento de casos de erro**  
‚úÖ **Performance e responsividade**  

---

**üìß Suporte**: Para d√∫vidas sobre os testes, consulte a documenta√ß√£o ou abra uma issue no reposit√≥rio.

**üìÖ √öltima Atualiza√ß√£o**: Janeiro 2025 